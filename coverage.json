{
  "kind": "coverage_report",
  "version": "1.0",
  "generatedAt": "2026-02-24T19:42:48.722Z",
  "sources": {
    "buildRequest": true,
    "implementationPlan": true
  },
  "requirements": {
    "total": 10,
    "implemented": 6,
    "items": [
      {
        "id": "REQ-73",
        "summary": "Add an `approvalStatus` field to the Order data type in `backend/main.mo` using a variant type with three states: `#pending`, `#approved`, `#declined`. All newly placed orders must default to `#pending`. Add `giftCardNumber: Text` and `giftCardBalance: Text` fields to the Order data type to store UK Gift Card details captured at checkout (both default to empty string for non-gift-card orders).",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-74",
        "summary": "Expose two admin-gated functions in `backend/main.mo`: `approveOrder(orderId: Nat) : async Result.Result<(), Text>` and `declineOrder(orderId: Nat) : async Result.Result<(), Text>`. Both functions must verify the caller's username is in the admin whitelist before mutating the order's `approvalStatus`. Return `#err` with a descriptive message if the order is not found or the caller is not an admin.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-75",
        "summary": "Expose a public query function in `backend/main.mo`: `getOrdersByBuyer(principal: Principal) : async [Order]` that returns all orders placed by the given principal, including their current `approvalStatus`. This allows the buyer-facing UI to query and display their order statuses.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-76",
        "summary": "Add React Query hooks to `frontend/src/hooks/useQueries.ts` for the new order approval backend functions: `useApproveOrder()` mutation calling `approveOrder`, `useDeclineOrder()` mutation calling `declineOrder`, and `useOrdersByBuyer()` query calling `getOrdersByBuyer` with the authenticated user's principal. All mutations must await the actor call, unwrap the `#ok`/`#err` Result variant, throw a JavaScript `Error` on `#err`, and invalidate the `orders` query cache on success. The `useOrdersByBuyer` query must be enabled only when the user is authenticated.",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/hooks/useQueries.ts"
        ],
        "matchedFiles": [
          "frontend/src/hooks/useQueries.ts"
        ]
      },
      {
        "id": "REQ-77",
        "summary": "Update `frontend/src/components/checkout/GiftCardPayment.tsx` to capture two additional fields during the gift card checkout step: a 'Gift Card Number' text input and a 'Gift Card Balance' text input (or select). These values must be passed through to the order placement call so they are stored on the order record in the backend. Both fields are required before the user can confirm the order.",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/components/checkout/GiftCardPayment.tsx"
        ],
        "matchedFiles": [
          "frontend/src/components/checkout/GiftCardPayment.tsx"
        ]
      },
      {
        "id": "REQ-78",
        "summary": "Update the `placeOrder` mutation in `frontend/src/hooks/useQueries.ts` and the order placement logic in `frontend/src/pages/CheckoutPage.tsx` to pass `giftCardNumber` and `giftCardBalance` fields when the selected payment method is 'Gift Card'. For all other payment methods, these fields must be sent as empty strings to match the updated backend Order type.",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/hooks/useQueries.ts",
          "frontend/src/pages/CheckoutPage.tsx"
        ],
        "matchedFiles": [
          "frontend/src/hooks/useQueries.ts",
          "frontend/src/pages/CheckoutPage.tsx"
        ]
      },
      {
        "id": "REQ-79",
        "summary": "Create a new admin component `frontend/src/components/admin/PaymentsManager.tsx`. This component must: (1) fetch all orders via the existing orders query; (2) display each order in a table or card list showing: buyer username, email, contact info, product(s) purchased, payment method badge, approval status badge (`#pending` = amber, `#approved` = green, `#declined` = red), and — for gift card orders — the gift card number and balance; (3) provide 'Approve' and 'Decline' buttons per order that call the `useApproveOrder` and `useDeclineOrder` mutations respectively; (4) show a success or error toast on each action; (5) apply the sunset theme consistently (dusk-bg/dusk-mid backgrounds, sunset-gold/sunset-orange/sunset-pink accent colours, Orbitron/Rajdhani fonts).",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/components/admin/PaymentsManager.tsx"
        ],
        "matchedFiles": [
          "frontend/src/components/admin/PaymentsManager.tsx"
        ]
      },
      {
        "id": "REQ-80",
        "summary": "Add a new 'Payments' tab to the admin panel in `frontend/src/pages/AdminPanelPage.tsx`, alongside the existing Products, Orders, Admins, Subscriptions, and Settings tabs. The tab content must render the `PaymentsManager` component. The tab must be labelled 'Payments' and must not disrupt the existing tab order or default active tab.",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/pages/AdminPanelPage.tsx"
        ],
        "matchedFiles": [
          "frontend/src/pages/AdminPanelPage.tsx"
        ]
      },
      {
        "id": "REQ-81",
        "summary": "Add an in-app order status notification to `frontend/src/pages/OrderConfirmationPage.tsx` that displays the current `approvalStatus` of the order (Pending / Approved / Declined) fetched live from the backend. The status must update reactively — if an admin approves or declines the order after the page is loaded, the buyer should see the updated status on refresh or via polling (React Query refetch interval of 30 seconds is acceptable). Display the status with a clear label and colour-coded indicator: amber for pending, green for approved, red for declined.",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/hooks/useQueries.ts",
          "frontend/src/pages/OrderConfirmationPage.tsx"
        ],
        "matchedFiles": [
          "frontend/src/hooks/useQueries.ts",
          "frontend/src/pages/OrderConfirmationPage.tsx"
        ]
      },
      {
        "id": "REQ-82",
        "summary": "Update `backend/migration.mo` to handle migration of existing Order records to include the new `approvalStatus` (defaulting to `#pending`), `giftCardNumber` (defaulting to `\"\"`), and `giftCardBalance` (defaulting to `\"\"`) fields. Ensure the migration preserves all existing order data and does not lose any previously stored orders.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      }
    ]
  },
  "changedFiles": [
    "backend/main.mo",
    "backend/migration.mo",
    "build-request.json",
    "feature_evidence.json",
    "frontend-file-summaries.txt",
    "frontend-implementation-plan.json",
    "frontend/src/backend.d.ts",
    "frontend/src/backend.ts",
    "frontend/src/components/admin/PaymentsManager.tsx",
    "frontend/src/components/checkout/GiftCardPayment.tsx",
    "frontend/src/declarations/backend.did.d.ts",
    "frontend/src/declarations/backend.did.js",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/AdminPanelPage.tsx",
    "frontend/src/pages/CheckoutPage.tsx",
    "frontend/src/pages/OrderConfirmationPage.tsx",
    "project_state.json",
    "scratch/component-selection.json",
    "spec.md",
    "spec_vs_diff_report.json"
  ]
}