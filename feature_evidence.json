{
  "kind": "feature_evidence_report",
  "features": [
    {
      "featureId": "feature-rewrite-frontend-src-components-adminaccesscontrol-tsx-with-a-fully-auto-resolved-non-looping-sequential-gate-using-a-useeffect-local-state-imperative-async-flow-the-component-must-1-immediately-render-a-please-log-in-via-internet-identity-prompt-if-isauthenticated-is-false-do-not-show-a-spinner-or-form-2-once-isauthenticated-is-true-run-a-single-useeffect-that-imperatively-calls-the-backend-actor-s-getusername-function-directly-not-via-react-query-to-retrieve-the-stored-username-for-the-authenticated-principal-3-if-the-resolved-username-is-an-empty-string-or-null-undefined-render-the-profilesetupmodal-to-trigger-username-creation-do-not-spin-4-once-a-non-empty-username-string-is-confirmed-immediately-call-isadminusername-with-that-exact-username-string-never-pass-a-principal-undefined-or-null-5-as-soon-as-both-calls-complete-transition-immediately-and-permanently-to-either-granted-render-children-or-denied-render-accessdeniedscreen-using-a-local-status-state-variable-typed-loading-granted-denied-unauthenticated-no-username-6-the-useeffect-must-include-a-hasrun-ref-guard-if-hasrun-current-return-hasrun-current-true-to-ensure-it-executes-exactly-once-per-authentication-session-preventing-re-entry-and-infinite-loops-7-show-a-loading-spinner-only-while-status-loading-8-do-not-use-chained-react-query-enabled-flags-useisadminusername-or-useusername-hooks-for-the-gate-decision-all-async-work-must-be-imperative-inside-the-single-useeffect-9-apply-the-sunset-theme-dusk-bg-dusk-mid-backgrounds-sunset-gold-sunset-orange-accent-colours-orbitron-rajdhani-fonts-sunset-glow-effects-to-the-loading-spinner-login-prompt-and-any-intermediate-states",
      "featureTitle": "Rewrite `frontend/src/components/AdminAccessControl.tsx` with a fully auto-resolved, non-looping sequential gate using a `useEffect` + local state imperative async flow. The component must: (1) immediately render a 'Please log in via Internet Identity' prompt if `isAuthenticated` is false — do not show a spinner or form; (2) once `isAuthenticated` is true, run a single `useEffect` that imperatively calls the backend actor's `getUsername` function directly (NOT via React Query) to retrieve the stored username for the authenticated principal; (3) if the resolved username is an empty string or null/undefined, render the `ProfileSetupModal` to trigger username creation — do not spin; (4) once a non-empty username string is confirmed, immediately call `isAdminUsername` with that exact username string — never pass a principal, undefined, or null; (5) as soon as both calls complete, transition immediately and permanently to either `'granted'` (render children) or `'denied'` (render `AccessDeniedScreen`) using a local `status` state variable typed `'loading' | 'granted' | 'denied' | 'unauthenticated' | 'no-username'`; (6) the `useEffect` must include a `hasRun` ref guard (`if (hasRun.current) return; hasRun.current = true;`) to ensure it executes exactly once per authentication session, preventing re-entry and infinite loops; (7) show a loading spinner only while `status === 'loading'`; (8) do NOT use chained React Query `enabled` flags, `useIsAdminUsername`, or `useUsername` hooks for the gate decision — all async work must be imperative inside the single `useEffect`; (9) apply the sunset theme (dusk-bg/dusk-mid backgrounds, sunset-gold/sunset-orange accent colours, Orbitron/Rajdhani fonts, sunset glow effects) to the loading spinner, login prompt, and any intermediate states.",
      "files": [
        "frontend/src/components/AdminAccessControl.tsx"
      ],
      "components": [
        "authorization@4.0.0",
        "core-infrastructure@1.0.2",
        "shadcn-ui@1.0.0",
        "build-template-react@1.0.0",
        "initial-app@1.0.0",
        "github-export-icp-cli@1.0.0",
        "qr-code@1.0.0",
        "camera@1.0.0"
      ],
      "testIds": [
        "REQ-111"
      ],
      "confidence": "high"
    },
    {
      "featureId": "feature-audit-frontend-src-hooks-usequeries-ts-to-ensure-no-query-or-hook-configuration-can-cause-adminaccesscontrol-tsx-to-enter-an-infinite-re-fetch-loop-if-useusername-getusername-or-useisadminusername-hooks-are-still-present-for-other-consumers-set-their-staletime-to-at-least-60-000-ms-and-retry-to-1-confirm-that-none-of-these-hooks-are-wired-into-adminaccesscontrol-s-access-gating-logic-after-the-req-111-rewrite-the-admin-gate-must-rely-solely-on-the-imperative-actor-calls-getusername-and-isadminusername-inside-the-useeffect",
      "featureTitle": "Audit `frontend/src/hooks/useQueries.ts` to ensure no query or hook configuration can cause `AdminAccessControl.tsx` to enter an infinite re-fetch loop. If `useUsername`/`getUsername` or `useIsAdminUsername` hooks are still present for other consumers, set their `staleTime` to at least 60 000 ms and `retry` to 1. Confirm that none of these hooks are wired into `AdminAccessControl`'s access-gating logic after the REQ-111 rewrite — the admin gate must rely solely on the imperative actor calls (`getUsername` and `isAdminUsername`) inside the `useEffect`.",
      "files": [
        "frontend/src/hooks/useQueries.ts"
      ],
      "components": [
        "authorization@4.0.0",
        "core-infrastructure@1.0.2",
        "shadcn-ui@1.0.0",
        "build-template-react@1.0.0",
        "initial-app@1.0.0",
        "github-export-icp-cli@1.0.0",
        "qr-code@1.0.0",
        "camera@1.0.0"
      ],
      "testIds": [
        "REQ-113"
      ],
      "confidence": "high"
    }
  ]
}