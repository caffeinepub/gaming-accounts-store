{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Replace admin gate with 4-digit PIN (2006) + lockout system (Frontend)",
  "requirements": [
    {
      "id": "REQ-115",
      "summary": "Add React Query hooks for PIN verification and lockout status checking",
      "acceptanceCriteria": [
        "`useVerifyAdminPin` mutation correctly calls the backend `verifyAdminPin` function",
        "Mutation throws a JavaScript Error when the backend returns `#err` (e.g. lockout error)",
        "`useAdminPinLockoutStatus` query is enabled only when the user is authenticated",
        "Lockout status query has `staleTime: 0` and `retry: 0`"
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add `useVerifyAdminPin()` mutation hook that calls `actor.verifyAdminPin(pin: string)`, unwraps the Result variant (`#ok` with boolean or `#err` with string), throws a JavaScript Error on `#err`, and returns the boolean result on success. Add `useAdminPinLockoutStatus()` query hook that calls `actor.getAdminPinLockoutStatus(principal)` with the authenticated user's principal, enabled only when both actor and identity are available, with `staleTime: 0` and `retry: 0` to always reflect live lockout state. Both hooks must handle the backend interface types correctly (Result union and lockout status object with `isLockedOut: boolean` and `remainingSeconds: bigint`)."
        }
      ]
    },
    {
      "id": "REQ-116",
      "summary": "Replace AdminAccessControl with 4-digit PIN entry screen and lockout enforcement",
      "acceptanceCriteria": [
        "Unauthenticated users see a 'Please log in' prompt, not the PIN form",
        "Authenticated users immediately see the 4-digit PIN entry form",
        "Entering PIN '2006' and submitting transitions to access granted (admin panel renders)",
        "Entering any wrong PIN shows an inline error with remaining attempts",
        "After 4 wrong attempts, the form shows a lockout message with time remaining and disables the input/submit",
        "Pressing Enter in the PIN input triggers form submission",
        "Loading spinner shows only while the backend call is in-flight",
        "No username-based gate logic remains in this component",
        "Sunset theme is applied consistently to the PIN entry screen"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/AdminAccessControl.tsx",
          "operation": "modify",
          "description": "Rewrite the entire component to replace all username-based gate logic with a PIN-based flow. Remove all imports and usage of `getUsername`, `isAdminUsername`, `useUsername`, and `useIsAdminUsername`. The new flow: (1) If `identity` from `useInternetIdentity()` is null/undefined, render a centered prompt 'Please log in via Internet Identity to access the admin panel' with a link/button to trigger login â€” do not show the PIN form. (2) Once authenticated, render a styled 4-digit PIN entry screen with a heading 'Admin Access', subheading 'Enter the 4-digit PIN to continue', four single-digit input fields (or one input with maxLength=4 and inputMode='numeric'), and a 'Submit' button, all wrapped in a `<form onSubmit={handleSubmit}>`. (3) The `handleSubmit` async function must call `event.preventDefault()`, set a local `isSubmitting` state to true, call `actor.verifyAdminPin(pinValue)` directly (not via React Query mutation), unwrap the Result variant, and handle: on `#ok(true)` transition to `status = 'granted'` and render `{children}`; on `#ok(false)` or `#err` with remaining attempts, display inline error 'Incorrect PIN. X attempts remaining.' and clear the PIN input; on `#err` indicating lockout, display the lockout message (e.g., 'Too many failed attempts. Try again in X minutes.') and disable the form fields. (4) Use try/catch to handle any thrown errors and display them as inline error messages. (5) Show a loading spinner or disabled state only while `isSubmitting` is true. (6) Apply sunset theme colors (dusk-bg/dusk-mid backgrounds, sunset-gold/sunset-orange accents, Orbitron/Rajdhani fonts, sunset glow effects) to the PIN entry screen using Tailwind classes consistent with `frontend/src/index.css` and `frontend/tailwind.config.js`. Remove all references to ProfileSetupModal or username checks from this component."
        }
      ]
    },
    {
      "id": "REQ-117",
      "summary": "Remove all internal gates from AdminPanelPage",
      "acceptanceCriteria": [
        "AdminPanelPage renders its tabbed content immediately once AdminAccessControl grants access",
        "No internal `isAdminUsername`, `verifyAdminPin`, loading state, or async `useEffect` gate exists in AdminPanelPage",
        "All six tabs (Products, Orders, Payments, Admins, Subscriptions, Settings) are visible and functional"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/AdminPanelPage.tsx",
          "operation": "modify",
          "description": "Audit the file and remove any remaining username-based checks, PIN verification calls, `isAdminUsername`, `useIsAdminUsername`, or async `useEffect` gates. Ensure the page renders its tabbed content (Products, Orders, Payments, Admins, Subscriptions, Settings) immediately and unconditionally, relying solely on the `AdminAccessControl` wrapper for access control. Confirm all six tabs remain present and wired correctly."
        }
      ]
    }
  ]
}